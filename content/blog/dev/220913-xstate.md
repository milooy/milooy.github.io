---
title: XState
description: 제발 날 살려조
date: "2022-09-13"
category: dev
---

## 나의 이해

### 유한 상태 기계란?

- like 신호등.
  - 빨강/노랑/초록 세개의 상태 사이를 넘나든다.
  - 한번에 빨강이면서 노랑일 순 없다.
  - 초록이 시간이 지나면 노랑이 되고, 노랑이 시간이 지나면 빨강이 됨 (상태 사이를 바꾸는 조건이 있다. 상태는 특정 조건이 되면 다른 상태로 변한다)

### Boolean explosion

신호등을 코드로 짜기 (빨/초 만 있다 가정)

#### Step1. Boolean들로 짜기

- 가장 쉬운 접근방법, boolean으로 코드 짜기
  - boolean 상태 2개: isRed, isGreen
  - 액션: 토글
    - 토글을 호출하면 red에서 green으로, 혹은 green에서 red로 색을 바꾼다
- 여기에 상태 하나를 추가한다면?
  - boolean 상태 3개: isRed, isGreen, isBroken
  - 액션: 토글, 운석떨어짐
    - 운석이 떨어지면 isBroken: true로 바꾼다
- 버그가 날 구멍이 생김!
  - 토글 액션에 isBroken이면 토글 안 되도록 추가 코딩 해줘야한다.
  - 이런식으로 boolean 값이 추가될수록 여기저기를 추가적으로 수정해줘야함...

#### Step2. 열거형으로 개선하기

- 표현 가능한 상태를 하나만 둔다
  - state: RED | GREEN | BROKEN
  - 토글이든, 운석떨어짐이든 액션마다 현재 가용한 상태를 한 번에 관리할 수 있어(switchcase 사용 등) 버그가 날 구멍이 줄어든다

#### Step3. 상태머신으로 개선하기

```js
const 신호등상태 = {
  RED: {
    액션: {
      토글: "GREEN",
      운석떨어짐: "BROKEN",
    },
  },
  GREEN: {
    액션: {
      토글: "RED",
      운석떨어짐: "BROKEN",
    },
  },
  BROKEN: {
    액션: {},
    특징: "끝", // 더 이상 할 액션이 없으니
  },
}
const 신호등상태머신 = Machine(신호등상태, { 초기값: "RED" })
const 신호등 = interpret(신호등상태머신).start()

신호등.이벤트보내("토글")
console.log(신호등.state.value) // GREEN
신호등.이벤트보내("토글") // RED
신호등.이벤트보내("운석떨어짐") // BROKEN
```

- 가질 수 있는 상태와 이 상태가 다른 상태로 바뀔때의 액션을 적어준다.
- 이벤트를 보내주면 상태가 알아서 숑숑 바뀐다

#### FSM의 좋은점

- 디자이너는 이미 FSM의 다이어그램처럼 사고함.
  - 개발자는 개발할 때 바텀업으로 사고하기 쉬움
  - 디자이너와 개발자의 single source of truth를 맞추기

## Building an acquisition Funnel in React with Xstate

https://dev.indooroutdoor.io/building-an-acquisition-funnel-in-react-with-xstate

- 단단하고, 읽기 좋고, 결정론적인 모델링 프로세스
- FSM이랑 퍼널의 궁합이 좋은 이유
  - 필요한 순간에 필요한 스텝을 보여줘야 하기 때문
  - 유저 액션 시퀀스에 따라 퍼널 상태가 결정되기 때문
  - 올바른 다이어그램만 그려두면 퍼널이 우리가 설계한대로 동작할거라고 기대할 수 있다!

## Xstate Docs Speedrun

https://www.youtube.com/watch?v=2eurRx-tR-I&t=670s&ab_channel=MattPocock

## XState 의 기본 익혀보기

- https://www.rinae.dev/posts/learning-xstate
